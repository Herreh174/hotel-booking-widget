<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Отменить бронирование</title>
  <div class="form-container">
  <div id="bookingForm">
    <h3>Отмена бронирования</h3>
    <input type="text" id="cancelPhone" placeholder="Введите номер телефона">
    <input type="text" id="cancelBookingID" placeholder="ИЛИ введите ID бронирования">
    <button onclick="checkBooking()">Отправить запрос</button>
  </div>
</div>

<!-- Модальное окно -->
<div class="modal" id="confirmModal">
  <div class="modal-content">
    <div class="modal-icon">⚠️</div>
    <div id="modalText">Загрузка...</div>
    <button class="modal-button" onclick="confirmCancel()">Да, отменить</button>
    <button class="modal-button" onclick="closeModal()">Нет</button>
  </div>
</div>

<!-- Toast сообщение -->
<div class="toast" id="toast" style="display:none;">Успешно отменено</div>

<style>
  .form-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px 20px;
  }

  #bookingForm {
    width: 100%;
    max-width: 500px;
    animation: fadeIn 1s ease forwards;
  }

  #bookingForm input {
    display: block;
    margin-bottom: 10px;
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  #bookingForm button {
    display: block;
    margin: 0 auto;
    padding: 10px 20px;
    background: #FFD700;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }

  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to   {opacity: 1; transform: translateY(0);}
  }

  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #FFD700;
    color: #333;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    z-index: 9999;
    animation: slideDown 0.5s ease forwards;
  }

  @keyframes slideDown {
    from {opacity: 0; transform: translateY(-20px);}
    to   {opacity: 1; transform: translateY(0);}
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: #fff;
    padding: 30px 40px;
    border-radius: 16px;
    text-align: center;
    max-width: 400px;
    transform: scale(0.8);
    opacity: 0;
    animation: zoomIn 0.4s forwards;
  }

  .modal-icon {
    font-size: 50px;
    color: #FFD700;
    margin-bottom: 15px;
  }

  .modal-button {
    margin-top: 10px;
    margin-left: 10px;
    padding: 10px 20px;
    background: #FFD700;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    color: #333;
    font-weight: bold;
    transition: background 0.3s;
  }

  .modal-button:hover {
    background: #e6c200;
  }

  @keyframes zoomIn {
    from {transform: scale(0.8); opacity: 0;}
    to   {transform: scale(1);   opacity: 1;}
  }
</style>


<script>
  let selectedBooking = null;

  function showToast(message) {
    const toast = document.getElementById('toast');
    toast.innerText = message;
    toast.style.display = 'block';
    setTimeout(() => toast.style.display = 'none', 3000);
  }

  function checkBooking() {
    const phone = document.getElementById('cancelPhone').value.trim();
    const bookingID = document.getElementById('cancelBookingID').value.trim();

    if (!phone && !bookingID) {
      alert('Введите номер телефона или ID бронирования');
      return;
    }

    // Отправляем GET-запрос в Google Apps Script для поиска брони
    fetch('https://script.google.com/macros/s/AKfycbx1HGikEA4w81gcxNKVVmTHSYtn_WIS5VIigm3eY2LGR9cAt73hiW3kOIiz67tFcqX6/exec?type=check&phone=' + phone + '&booking_id=' + bookingID)
      .then(res => res.json())
      .then(data => {
        if (data && data.booking) {
          selectedBooking = data.booking;
          document.getElementById('modalText').innerHTML =
            <b>Имя:</b> ${data.booking.full_name}<br>
             <b>Телефон:</b> ${data.booking.phone}<br>
             <b>Даты:</b> ${data.booking.checkin} - ${data.booking.checkout}<br><br>
             Вы уверены, что хотите отменить бронирование?;
          openModal();
        } else {
          alert('Бронирование не найдено');
        }
      })
      .catch(() => alert('Ошибка запроса'));
  }

  function openModal() {
    document.getElementById('confirmModal').style.display = 'flex';
  }

  function closeModal() {
    document.getElementById('confirmModal').style.display = 'none';
  }

  function confirmCancel() {
    if (!selectedBooking || !selectedBooking.booking_id) return;

    fetch('https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec', {
      method: 'POST',
      body: JSON.stringify({
        action: 'cancel',
        booking_id: selectedBooking.booking_id
      })
    })
    .then(res => res.json())
    .then(data => {
      closeModal();
      if (data.status === 'success') {
        showToast('Бронирование отменено');
      } else {
        alert('Ошибка отмены');
      }
    })
    .catch(() => alert('Ошибка запроса'));
  }
</script>
</head>
<body>
